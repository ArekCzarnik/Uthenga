dependencies:
  cache_directories:
    - "~/.stack"
    - "/home/ubuntu/.stack/"
    - ".stack-work"
  pre:
    - curl -L https://github.com/commercialhaskell/stack/releases/download/v1.4.0/stack-1.4.0-linux-x86_64.tar.gz | tar zx -C /tmp
    - sudo mv /tmp/stack-1.4.0-linux-x86_64/stack /usr/bin
  override:
    - stack setup
    - rm -fr $(stack path --dist-dir) $(stack path --local-install-root)
    - stack build --fast
    
test:
  pre:
    - curl -L https://github.com/rubik/stack-hpc-coveralls/releases/download/v0.0.4.0/shc-linux-x64-7.8.4.tar.bz2 | tar jx -C /tmp
    - sudo mv /tmp/shc /usr/bin
  override:
    - stack test --no-terminal --coverage
    - stack exec -- shc --repo-token=$COVERALLS_REPO_TOKEN Uthenga uthenga-test
